<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nepaltr Pro - Optimized Trade View</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <style>
        :root { --bg: #060d17; --panel: #111a27; --accent: #fcc419; --up: #00c076; --down: #ff3b30; --border: #1c2735; }
        
        /* Forces the body to be exactly the size of the phone screen */
        body, html { 
            margin: 0; padding: 0; 
            height: 100%; width: 100%; 
            background: var(--bg); color: white; 
            overflow: hidden; /* Prevents unwanted scrolling */
        }

        #app-interface { 
            display: flex; flex-direction: column; 
            height: 100vh; width: 100vw; 
        }

        /* --- HEADER --- */
        header { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 0 15px; height: 55px; 
            background: var(--panel); border-bottom: 1px solid var(--border); 
        }

        .header-actions { display: flex; align-items: center; gap: 12px; }
        .wallet-icon { cursor: pointer; font-size: 20px; color: var(--accent); }

        /* --- CHART AREA --- */
        #chart-area { 
            flex-grow: 1; /* Takes up all available space */
            width: 100%; 
            background: #131722; 
        }

        /* --- FIXED TRADE DOCK (Visible at bottom) --- */
        .trade-dock { 
            background: var(--panel); 
            padding: 12px; 
            border-top: 1px solid var(--border);
            padding-bottom: env(safe-area-inset-bottom); /* Fix for iPhone/Newer Android notches */
        }

        .input-row { display: flex; gap: 10px; margin-bottom: 10px; }
        .box { 
            flex: 1; background: #060d17; 
            border: 1px solid var(--border); 
            padding: 5px 10px; border-radius: 8px; 
        }
        .box label { font-size: 10px; color: #848e9c; display: block; }
        .box input { 
            background: transparent; border: none; 
            color: white; width: 100%; 
            font-size: 16px; font-weight: bold; outline: none; 
        }

        .btn-container { display: flex; gap: 10px; height: 50px; }
        .trade-btn { 
            flex: 1; border: none; border-radius: 8px; 
            color: white; font-weight: bold; font-size: 18px; 
            cursor: pointer; transition: 0.2s; 
        }
        .up { background: var(--up); }
        .down { background: var(--down); }
        .trade-btn:active { opacity: 0.7; transform: scale(0.98); }

        /* --- HUB MODAL --- */
        #hub-modal { 
            position: fixed; inset: 0; 
            background: rgba(0,0,0,0.9); 
            display: none; z-index: 9999; 
            justify-content: center; align-items: center; 
        }
        .hub-content { 
            background: var(--panel); width: 85%; 
            padding: 20px; border-radius: 15px; 
            text-align: center; border: 1px solid var(--border); 
        }
        .hub-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
        .hub-btn { background: #060d17; padding: 15px; border-radius: 10px; border: 1px solid var(--border); cursor: pointer; }
    </style>
</head>
<body>

<div id="app-interface">
    <header>
        <div style="font-weight:bold; color:var(--accent)">NEPALTR PRO</div>
        <div class="header-actions">
            <div onclick="openHub()" style="cursor:pointer; text-align:right">
                <div style="font-size:10px; color:#848e9c">Balance â–¼</div>
                <div id="display-bal" style="font-weight:bold; color:var(--accent)">NPR 0.00</div>
            </div>
            <div class="wallet-icon" onclick="openHub()">ðŸ‘›</div>
            <div style="font-size:20px; cursor:pointer;">ðŸ””</div>
        </div>
    </header>

    <div id="chart-area">
        <div id="tv_widget" style="height:100%; width:100%;"></div>
    </div>

    <div class="trade-dock">
        <div class="input-row">
            <div class="box"><label>INVESTMENT</label><input type="number" value="130" id="amt"></div>
            <div class="box"><label>DURATION</label><input type="text" value="01:00" readonly></div>
        </div>
        <div class="btn-container">
            <button class="trade-btn up" onclick="trade('HIGHER')">UP</button>
            <button class="trade-btn down" onclick="trade('LOWER')">DOWN</button>
        </div>
    </div>
</div>

<div id="hub-modal" onclick="closeHub(event)">
    <div class="hub-content">
        <h3>Account Hub</h3>
        <p id="hub-bal-large" style="font-size:24px; color:var(--accent); font-weight:bold;">NPR 0.00</p>
        <div class="hub-grid">
            <div class="hub-btn" onclick="alert('Open Deposit')">Deposit</div>
            <div class="hub-btn" onclick="alert('Open Withdraw')">Withdraw</div>
            <div class="hub-btn" onclick="alert('Open History')">History</div>
            <div class="hub-btn" onclick="location.reload()">Refresh</div>
        </div>
    </div>
</div>

<script src="https://s3.tradingview.com/tv.js"></script>
<script>
    // --- FIREBASE SETUP ---
    const firebaseConfig = {
      apiKey: "AIzaSyCNt94Sr7tvtY6bLQcYCYeRb_cTcah7fE4",
      authDomain: "earning-website-644a7.firebaseapp.com",
      databaseURL: "https://earning-website-644a7-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "earning-website-644a7",
      storageBucket: "earning-website-644a7.firebasestorage.app",
      appId: "1:20748471330:web:5e8d18499679ecb3d04e7b"
    };
    firebase.initializeApp(firebaseConfig);

    // --- APP LOGIC ---
    function openHub() { document.getElementById('hub-modal').style.display = 'flex'; }
    function closeHub(e) { if(e.target.id === 'hub-modal') e.target.style.display = 'none'; }

    function trade(dir) {
        const val = document.getElementById('amt').value;
        alert("Trade Placed: " + dir + " for NPR " + val);
    }

    firebase.auth().onAuthStateChanged(user => {
        if(user) {
            firebase.database().ref('users/' + user.uid).on('value', snap => {
                const b = snap.val()?.balance || 0;
                document.getElementById('display-bal').innerText = "NPR " + b.toFixed(2);
                document.getElementById('hub-bal-large').innerText = "NPR " + b.toFixed(2);
            });
            initChart();
        } else {
            firebase.auth().signInAnonymously();
        }
    });

    function initChart() {
        new TradingView.widget({
            "autosize": true,
            "symbol": "BINANCE:BTCUSDT",
            "interval": "1",
            "theme": "dark",
            "container_id": "tv_widget",
            "hide_top_toolbar": false,
            "allow_symbol_change": true,
            "save_image": false,
        });
    }
</script>
</body>
</html>
